<!DOCTYPE html>
<html>
<head>
    <title>Amazon Item Price Tracker</title>
    <script>
    // 1. First try to trigger a price update
    fetch('https://api.github.com/repos/agoncziDemos/AmazonScraperDemo/dispatches', {
        method: 'POST',
        headers: {
            'Accept': 'application/vnd.github.v3+json',
            'Authorization': 'token HERE' // REPLACE THIS
        },
        body: JSON.stringify({
            event_type: 'price_update'
        })
    })
    .catch(error => console.log("Update trigger failed (viewers can ignore this)", error))
    .finally(() => {
        // 2. Then load the latest price file with cache busting
        fetch('price.txt?t=' + Date.now())
            .then(response => response.text())
            .then(price => {
                document.body.innerHTML = `<pre>${price}</pre>`;
            })
            .catch(() => {
                document.body.innerHTML = "Price loading failed - try refreshing";
            });
    });
    </script>
    <style>
        body {
            font-family: monospace;
            text-align: center;
            margin-top: 50px;
            background: #f6f8fa;
        }
        pre {
            display: inline-block;
            padding: 20px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    Loading latest price...
</body>
</html>
